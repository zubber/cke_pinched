{"ts":1376825488527,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"$(document).ready(function(){\r\n\r\n    CKEDITOR.plugins.add('insertphoto', {\r\n\t\tinit : function(editor) {\r\n\t\t\teditor.addCommand( 'insertphoto', new CKEDITOR.dialogCommand( 'insertphotoDialog' ) );\r\n            //добавляем кнопку в интерфейс\r\n\t\t\teditor.ui.addButton('rtPhoto', {\r\n\t\t\t\ticon    : '/i/ico_btn_img.gif',\r\n\t\t\t\tlabel   : 'Вставить фото',\r\n\t\t\t\tcommand : 'insertphoto'\r\n\t\t\t});\r\n\t\t\tCKEDITOR.dialog.add( 'insertphotoDialog', this.path + 'dialogs/insertphoto.js' );\r\n\t\t\t\r\n            /**\r\n             * получаем хтмл код редактирования блока фото\r\n             * @param photoId\r\n             * @param src\r\n             * @param title\r\n             */\r\n            var getPhotoEditHtml = function(photoId, src, title) {\r\n\r\n                return '\\\r\n                    <div contenteditable=\"false\" photoid=\"' + photoId + '\" class=\"picture\" style=\"width:534px;\">\\\r\n                        <div contenteditable=\"false\" class=\"img\" style=\"background:url(' + src + ') no-repeat center center;height:363px;\">\\\r\n                            <span contenteditable=\"false\" class=\"del\">&nbsp;</span>\\\r\n                            <div contenteditable=\"false\" class=\"clear_both\">&nbsp;</div>\\\r\n                        </div>\\\r\n                        <div class=\"t\" contenteditable=\"false\" width=\"100%\">' + getTitleHtml(title) + '</div>\\\r\n                    </div>';\r\n            };\r\n\t\t\t\r\n            /**\r\n             * получаем внутренний хтмл код блока фото (в том виде, в котором он хранится в бд)\r\n             * @param photoId\r\n             * @param src\r\n             * @param title\r\n             */\r\n            var getPhotoInternalHtml = function(photoId, src, title) {\r\n\r\n                return '<placeholder type=\"photo\" photoid=\"' + photoId + '\" photosrc=\"' + src + '\" phototitle=\"' + title + '\">_</placeholder>';\r\n            };\r\n\r\n\t\t}\r\n\t});\r\n\t\r\n\t\r\n\t\r\n});"]],"start1":0,"start2":0,"length1":0,"length2":1860}]],"length":1860}
{"contributors":[],"silentsave":false,"ts":1376825569556,"patch":[[{"diffs":[[0,"tor) {\r\n"],[1,"/*"],[0,"\t\t\tedito"]],"start1":97,"start2":97,"length1":16,"length2":18},{"diffs":[[0,"js' );\r\n"],[-1,"\t\t\t"],[1,"*/\r\n\r\n            editor.addCommand( 'insertphoto', function(editor) {\r\n                editor.popup( 'lib/insertphoto.php' );\r\n            } );"],[0,"\r\n      "]],"start1":463,"start2":463,"length1":19,"length2":160}]],"length":2003,"saved":false}
{"ts":1376825587209,"patch":[[{"diffs":[[0,"йс\r\n"],[-1,"\t\t\teditor.ui.addButton('rtPhoto', {\r\n\t\t\t\ticon    : '/i/ico_btn_img.gif',\r\n\t\t\t\tlabel   : 'Вставить фото',\r\n\t\t\t\tcommand : 'insertphoto'\r\n\t\t\t});\r\n"],[0,"\t\t\tC"]],"start1":238,"start2":238,"length1":151,"length2":8},{"diffs":[[0,"      } );\r\n"],[1,"            \r\n    \t\teditor.ui.addButton('rtPhoto', {\r\n\t\t\t\ticon    : '/i/ico_btn_img.gif',\r\n\t\t\t\tlabel   : 'Вставить фото',\r\n\t\t\t\tcommand : 'insertphoto'\r\n\t\t\t});\r\n"],[0,"            "]],"start1":462,"start2":462,"length1":24,"length2":184}]],"length":2020,"saved":false}
{"ts":1376825798482,"patch":[[{"diffs":[[0,"tphoto',"],[1," {\r\n                exec:"],[0," functio"]],"start1":371,"start2":371,"length1":16,"length2":41},{"diffs":[[0,"       }"],[1," }"],[0," );\r\n   "]],"start1":486,"start2":486,"length1":16,"length2":18}]],"length":2047,"saved":false}
{"ts":1376826356712,"patch":[[{"diffs":[[0,"            "],[1,"    "],[0,"editor.popup"]],"start1":429,"start2":429,"length1":24,"length2":28}]],"length":2051,"saved":false}
{"ts":1376826906813,"patch":[[{"diffs":[[0,"(editor) {\r\n"],[1,"                    var editor_name = CKEDITOR.currentInstance.name;\r\n                    alert(editor_name);\r\n"],[0,"            "]],"start1":413,"start2":413,"length1":24,"length2":135},{"diffs":[[0,"hoto.php"],[-1,"'"],[1,"?CKEditor='+editor_name"],[0," );\r\n   "]],"start1":582,"start2":582,"length1":17,"length2":39}]],"length":2184,"saved":false}
{"contributors":[],"silentsave":false,"ts":1376922013250,"patch":[[{"diffs":[[0," {\r\n"],[-1,"/*\t\t\teditor.addCommand( 'insertphoto', new CKEDITOR.dialogCommand( 'insertphotoDialog' ) );\r\n            //добавляем кнопку в интерфейс\r\n\t\t\tCKEDITOR.dialog.add( 'insertphotoDialog', this.path + 'dialogs/insertphoto.js' );\r\n*/\r\n\r\n"],[0,"    "]],"start1":101,"start2":101,"length1":237,"length2":8},{"diffs":[[0,"'insertphoto"],[1,"_showdialog"],[0,"', {\r\n      "]],"start1":136,"start2":136,"length1":24,"length2":35},{"diffs":[[0,"    "],[-1,"alert(editor_name);\r\n                    editor.popup("],[1,"var page ="],[0," 'li"]],"start1":293,"start2":293,"length1":62,"length2":18},{"diffs":[[0,"tor_name"],[-1," )"],[0,";\r\n     "]],"start1":343,"start2":343,"length1":18,"length2":16},{"diffs":[[0,"    "],[-1,"} } );\r\n            \r\n    \t\teditor.ui.addButton('rtP"],[1,"        window.insertp"],[0,"hoto"],[-1,"', {\r\n\t\t\t\ticon    : '/i/ico_btn_img.gif',\r\n\t\t\t\tlabel   : 'Вставить фото',\r\n\t\t\t\tcommand : 'insertphoto'\r\n\t\t\t});"],[1,"_dialog = $('<div id=\"insertphoto_dialog\"></div>')"],[0,"\r\n  "]],"start1":362,"start2":362,"length1":174,"length2":84},{"diffs":[[0,"')\r\n            "],[-1,"/**\r\n"],[0,"             * п"]],"start1":440,"start2":440,"length1":37,"length2":32},{"diffs":[[0,"    "],[-1,"* получаем хтмл код редактирования блока фото\r\n             * @param photoId"],[1,"          .html('<iframe style=\"border: 0px; \" src=\"' + page + '\" width=\"700\" height=\"380\"></iframe>')"],[0,"\r\n  "]],"start1":465,"start2":465,"length1":84,"length2":110},{"diffs":[[0,"    "],[-1,"* @param src\r\n             * @param title"],[1,"                      .dialog({"],[0,"\r\n  "]],"start1":582,"start2":582,"length1":49,"length2":39},{"diffs":[[0,"{\r\n             "],[-1,"*/\r\n"],[0,"            var "]],"start1":616,"start2":616,"length1":36,"length2":32},{"diffs":[[0,"    "],[-1,"var getPhotoEditHtml = function(photoId, src, title) {\r\n\r\n"],[1,"              autoOpen: false,\r\n "],[0,"    "]],"start1":640,"start2":640,"length1":66,"length2":41},{"diffs":[[0,"    "],[-1,"return '\\\r\n"],[1," "],[0,"    "]],"start1":689,"start2":689,"length1":19,"length2":9},{"diffs":[[0,"    "],[-1,"<div contenteditable=\"false\" photoid=\"' + photoId + '\" class=\"picture\" style=\"width:534px;\">\\\r\n                        <div contenteditable=\"false\" class=\"img\" style=\"background:url(' + src + ') no-repeat center center;height:363px;\">\\\r\n                            <span contenteditable=\"false\" class=\"del\">&nbsp;</span>\\\r\n                            <div contenteditable=\"false\" class=\"clear_both\">&nbsp;</div>\\"],[1," modal: true,\r\n                                       height: 800,\r\n                                       width: 800,\r\n                                       title: \"Insert photo\""],[0,"\r\n  "]],"start1":710,"start2":710,"length1":420,"length2":188},{"diffs":[[0,"        "],[-1,"</div>\\\r\n"],[0,"        "]],"start1":912,"start2":912,"length1":25,"length2":16},{"diffs":[[0,"                "],[1,"});\r\n"],[0,"             <di"]],"start1":915,"start2":915,"length1":32,"length2":37},{"diffs":[[0,"    "],[-1,"<div class=\"t\" contenteditable=\"false\" width=\"100%\">' + getTitleHtml(title) + '</div>\\\r\n                    </div>';\r\n"],[1,"       window.insertphoto_dialog.dialog('open');\r\n            } } );\r\n      "],[0,"      "],[1,"\r\n"],[0,"    "],[-1,"  };\r\n\t\t\t\r\n            /**\r\n             * получаем внутренний хтмл код блока фото (в том виде, в котором он хранится в бд)\r\n             * @param photoId"],[1,"\t\teditor.ui.addButton('rtPhoto', {\r\n\t\t\t\ticon    : '/i/ico_btn_img.gif',\r\n\t\t\t\tlabel   : 'Вставить фото',\r\n\t\t\t\tcommand : 'insertphoto_showdialog'\r\n\t\t\t});\r\n"],[0,"\r\n  "]],"start1":945,"start2":945,"length1":290,"length2":249},{"diffs":[[0,"    "],[-1," * @param src"],[0,"\r\n  "]],"start1":1200,"start2":1200,"length1":21,"length2":8},{"diffs":[[0,"    "],[-1," * @param title\r\n             */\r\n            var getPhotoInternalHtml = function(photoId, src, title"],[1,"editor.addCommand( 'insertphoto_edithtml', {\r\n                exec: function(editor, photo_data"],[0,") {\r\n"],[-1,"\r\n"],[0,"    "]],"start1":1214,"start2":1214,"length1":116,"length2":108},{"diffs":[[0,"    "],[-1,"return '<placeholder type=\"photo\" photoid=\"' + photoId + '\" photosrc=\"' + src + '\" phototitle=\"' + title + '\">_</placeholder>';"],[1,"    getPhotoEditHtml(photo_data);\r\n                "],[0,"\r\n  "]],"start1":1330,"start2":1330,"length1":135,"length2":59},{"diffs":[[0,"       }"],[1,"})"],[0,";\r\n\r\n\t\t}"]],"start1":1392,"start2":1392,"length1":16,"length2":18}]],"length":1430,"saved":false}
{"ts":1376922040661,"patch":[[{"diffs":[[0,"ht=\""],[-1,"3"],[1,"7"],[0,"80\">"]],"start1":551,"start2":551,"length1":9,"length2":9},{"diffs":[[0," width: "],[-1,"8"],[1,"4"],[0,"00,\r\n   "]],"start1":820,"start2":820,"length1":17,"length2":17}]],"length":1430,"saved":false}
{"ts":1376922073942,"patch":[[{"diffs":[[0,"height: "],[-1,"8"],[1,"10"],[0,"00,\r\n   "]],"start1":768,"start2":768,"length1":17,"length2":18}]],"length":1431,"saved":false}
{"ts":1376922085402,"patch":[[{"diffs":[[0,"height=\""],[1,"1"],[0,"780\"></i"]],"start1":547,"start2":547,"length1":16,"length2":17}]],"length":1432,"saved":false}
{"ts":1376922111113,"patch":[[{"diffs":[[0,"height=\""],[-1,"1"],[0,"780\"></i"]],"start1":547,"start2":547,"length1":17,"length2":16}]],"length":1431,"saved":false}
{"ts":1376922114975,"patch":[[{"diffs":[[0,"rt photo"],[1," 2"],[0,"\"\r\n     "]],"start1":886,"start2":886,"length1":16,"length2":18}]],"length":1433,"saved":false}
{"ts":1376922116844,"patch":[[{"diffs":[[0,"height=\""],[1,"2"],[0,"780\"></i"]],"start1":547,"start2":547,"length1":16,"length2":17}]],"length":1434,"saved":false}
{"contributors":[],"silentsave":false,"ts":1376922235140,"patch":[[{"diffs":[[0,"ht: "],[-1,"10"],[1,"4"],[0,"00,\r"]],"start1":773,"start2":773,"length1":10,"length2":9},{"diffs":[[0," width: "],[-1,"4"],[1,"8"],[0,"00,\r\n   "]],"start1":821,"start2":821,"length1":17,"length2":17}]],"length":1433,"saved":false}
{"ts":1376922238440,"patch":[[{"diffs":[[0,"height=\""],[-1,"2"],[0,"780\"></i"]],"start1":547,"start2":547,"length1":17,"length2":16}]],"length":1432,"saved":false}
{"ts":1376922269457,"patch":[[{"diffs":[[0,"height=\""],[-1,"7"],[1,"5"],[0,"80\"></if"]],"start1":547,"start2":547,"length1":17,"length2":17}]],"length":1432,"saved":false}
{"ts":1376925675977,"patch":[[{"diffs":[[0,"   \r\n           "],[1," //"],[0," editor.addComma"]],"start1":1203,"start2":1203,"length1":32,"length2":35},{"diffs":[[0," {\r\n            "],[1,"//"],[0,"    "],[1," "],[0,"exec: function(e"]],"start1":1265,"start2":1265,"length1":36,"length2":39},{"diffs":[[0,") {\r\n           "],[1," //"],[0,"         getPhot"]],"start1":1321,"start2":1321,"length1":32,"length2":35},{"diffs":[[0,"              \r\n"],[-1,""],[0,"            }});"]],"start1":1382,"start2":1382,"length1":32,"length2":32},{"diffs":[[0,"        "],[1," //"],[0," }});\r\n\r"]],"start1":1401,"start2":1401,"length1":16,"length2":19}]],"length":1444,"saved":false}
{"contributors":[],"silentsave":false,"ts":1377422558368,"patch":[[{"diffs":[[0,"    "],[-1,"editor.addCommand( 'insertphoto_showdialog', {\r\n                exec: function(editor) {\r\n                    var editor_name = CKEDITOR.currentInstance.name;\r\n                    var page = 'lib/insertphoto.php?CKEditor='+editor_name;\r\n                    window.insertphoto_dialog = $('<div id=\"insertphoto_dialog\"></div>')\r\n                                   .html('<iframe style=\"border: 0px; \" src=\"' + page + '\" width=\"700\" height=\"580\"></iframe>')\r\n                                   .dialog({\r\n                                       autoOpen: false,\r\n                                       modal: true,\r\n                                       height: 400,\r\n                                       width: 800,\r\n                                       title: \"Insert photo 2\"\r\n                                   });\r\n                    window.insertphoto_dialog.dialog('open');\r\n            } } );\r\n            \r\n    \t\teditor.ui.addButton('rtPhoto', {\r\n\t\t\t\ticon    : '/i/ico_btn_img.gif',\r\n\t\t\t\tlabel   : 'Вставить фото',\r\n\t\t\t\tcommand : 'insertphoto_showdialog'\r\n\t\t\t});\r\n\r\n            \r\n            // editor.addCommand( 'insertphoto_edithtml', {\r\n            //     exec: function(editor, photo_data) {\r\n            //         getPhotoEditHtml(photo_data);\r\n                \r\n            // }});\r\n"],[1,"var maxImageHeight  = 400;\r\n            var maxImageWidth   = 600;\r\n            /**\r\n             **************** Фукнции\r\n             */\r\n\r\n            /**\r\n             * получаем хтмл код редактирования блока фото\r\n             */\r\n            var getPhotoEditHtml = function(photo_data) {\r\n            \r\n                return '\\\r\n                    <div contenteditable=\"false\" photoid=\"' + photo_data.id + '\" class=\"picture\" style=\"width:534px;\">\\\r\n                        <div contenteditable=\"false\" class=\"img\" style=\"background:url(' + photo_data.src + ') no-repeat center center;height:' + maxImageHeight + 'px;\">\\\r\n                            <span contenteditable=\"false\" class=\"del\">&nbsp;</span>\\\r\n                            <div contenteditable=\"false\" class=\"clear_both\">&nbsp;</div>\\\r\n                        </div>\\\r\n                        <div class=\"t\" contenteditable=\"false\" width=\"100%\">' + getTitleHtml( photo_data.title ) + '</div>\\\r\n                    </div>';\r\n            };\r\n\r\n\r\n            /**\r\n             * получаем внутренний хтмл код блока фото (в том виде, в котором он хранится в бд)\r\n             */\r\n            var getPhotoInternalHtml = function(photo_data) {\r\n                return '<placeholder type=\"photo\" photoid=\"' + photo_data.id + '\" photosrc=\"' + photo_data.src + '\" phototitle=\"' + photo_data.title + '\">_</placeholder>';\r\n            };\r\n            \r\n            /**\r\n             * получаем хтмл код описания\r\n             * @param title\r\n             */\r\n            var getTitleHtml = function(title) {\r\n            \r\n                if (title) {\r\n                    return '<span contenteditable=\"false\" class=\"edit\">&nbsp;</span><p contenteditable=\"false\">' + title + '</p><div contenteditable=\"false\" class=\"clear_both\"></div>';\r\n                } else {\r\n                    return '<div contenteditable=\"false\" class=\"add_desc\"><a contenteditable=\"false\" href=\"#\"><span contenteditable=\"false\">Добавить описание фотографии</span></a></div>';\r\n                }\r\n            };\r\n\r\n            /**\r\n             * Подготовка данных для отображения в editor'е\r\n             * @param e\r\n             */\r\n            var dataReadyHandler = function(e) {\r\n                if (isDefined(e.editor.document)) {\r\n\r\n                    //находим все блоки фото, сейчас они в внутреннем виде\r\n                    var placeholders = e.editor.document.getElementsByTag(\"placeholder\");\r\n                    var el;\r\n\r\n                    //для каждого\r\n                    for (var i = placeholders.count()-1; i >= 0; i--) {\r\n                        el = placeholders.getItem(i);\r\n\r\n                        if(el.getAttribute(\"type\") != \"photo\"){\r\n                            continue;\r\n                        }\r\n\r\n                        //выдираем нужные нам параметры из вёрстки\r\n                        var photo_data = { \r\n                            id: el.getAttribute('photoid')\r\n                            , src: el.getAttribute('photosrc')\r\n                            , title : el.getAttribute('phototitle')\r\n                        };\r\n\r\n                        //заменяем блоки\r\n                        $(el['$']).replaceWith(getPhotoEditHtml(photo_data));\r\n                    }\r\n\r\n                    //навесить ивенты\r\n                    preparePhotos();\r\n                }\r\n            };\r\n            \r\n            /**\r\n             * подготовливаем блок редактирования фотографии\r\n             */\r\n            var preparePhotos = function() {\r\n                var jqDelPhotos = $(editor.document['$']).find('.picture .img .del');\r\n                var jqEditTitle = $(editor.document['$']).find('.picture span.edit, .picture .add_desc a, .picture p');\r\n\r\n                //редактирование фото\r\n                jqEditTitle.unbind('click').click(function() {\r\n\r\n                    var _selfFunc = arguments.callee;\r\n\r\n                    var e = $(this).parents('.picture');\r\n                    var title  = e.find('div.t p').text();\r\n                    var jqPopup = $('#add_desc_photo');\r\n                    var jqTextarea = jqPopup.find('textarea');\r\n\r\n                    //ввод текста\r\n                    jqTextarea.val(title || '').bind('focus keyup', function(){\r\n\r\n                        if ($(this).val().length >= 300) {\r\n                            $(this).val($(this).val().substr(0, 300))\r\n                            return false;\r\n                        }\r\n                    });\r\n\r\n                    //очищаем описание\r\n                    jqPopup.find('a.cancel').unbind('click').click(function() {\r\n                        jqPopup.find('textarea').val('');\r\n                        return false;\r\n                    });\r\n\r\n                    //устанавлвиаем описание\r\n                    jqPopup.find('a.choose').unbind('click').click(function(){\r\n                        var titleHtml = getTitleHtml($.trim(jqPopup.find('textarea').val().replace(/\\s+/gi,' ').replace(/\"+/gi, '').replace(/<\\/?[^>]+>|\\&[^;]+;/gi, '')));\r\n                        e.find('div.t').html(titleHtml);\r\n                        e.find('span.edit, .add_desc a, p').click(_selfFunc);\r\n                        jqPopup.hide();\r\n                        jqPopup.dialog('close');\r\n                        $('#overlay').remove();\r\n                        return false;\r\n                    });\r\n\r\n                    //jqPopup.overlay().show();\r\n                    var d = jqPopup.dialog({\r\n                        autoOpen: false,\r\n                        modal: true,\r\n                        height: 400,\r\n                        width: 800,\r\n                        title: \"Insert photo 2\"\r\n                    });\r\n                    d.dialog('open');\r\n                    jqTextarea.focus().setCursorPosition(jqTextarea.val().length);\r\n\r\n                    return false;\r\n                });\r\n\r\n                //удаление фото\r\n                jqDelPhotos.unbind('click').click(function(){\r\n\r\n                    var element = $(this).parents('.picture');\r\n                    var result = confirm('Вы действительно хотите удалить данную фотографию из заметки?', undefined, undefined, 'Удаление фотографии из заметки');\r\n                    if ( result ) {\r\n                            element.remove();\r\n                    }\r\n                    return false;\r\n                });\r\n            };\r\n            \r\n            var newPreloadImage = function() \r\n            {\r\n                return $(\"<img src='' alt='изображение загружается' />\"); \r\n            }\r\n            \r\n            /**\r\n             **************** Команды редактора\r\n             */\r\n            \r\n            //показать диалог добавления фото\r\n            editor.addCommand( 'insertphoto_showdialog', {\r\n                exec: function(editor) {\r\n                    var editor_name = CKEDITOR.currentInstance.name;\r\n                    var page = 'lib/insertphoto.php?CKEditor='+editor_name;\r\n                    window.insertphoto_dialog = $('<div id=\"insertphoto_dialog\"></div>')\r\n                                   .html('<iframe style=\"border: 0px; \" src=\"' + page + '\" width=\"700\" height=\"580\"></iframe>')\r\n                                   .dialog({\r\n                                       autoOpen: false,\r\n                                       modal: true,\r\n                                       height: 400,\r\n                                       width: 800,\r\n                                       title: \"Insert photo 2\"\r\n                                   });\r\n                    window.insertphoto_dialog.dialog('open');\r\n                    \r\n                    // window.insertphoto_dialog = $('<div id=\"insertphoto_dialog\"></div>')\r\n                    //                .html('<iframe style=\"border: 0px; \" src=\"' + page + '\" width=\"700\" height=\"580\"></iframe>')\r\n                    //                .dialog({\r\n                    //                    autoOpen: false,\r\n                    //                    modal: true,\r\n                    //                    height: 400,\r\n                    //                    width: 800,\r\n                    //                    title: \"Insert photo 2\"\r\n                    //                });\r\n                    // window.insertphoto_dialog.dialog('open');\r\n            } } );\r\n\r\n            /** \r\n             * добавление фото в едитор\r\n             * @param photo_data {id,src,title}\r\n             */\r\n            editor.addCommand('pl_cmd_add_photo', {\r\n\r\n                exec: function(editor, photo_data) {\r\n                    //обработчик загрузки фото\r\n                    var handler = function() {\r\n                        var width, height;\r\n                        //Пытаемся определить размер\r\n                        if ( ! ( height = $(this).height() ) ) {\r\n                            if ( ! ( height = this.clientHeight) ) {\r\n                                if ( ! ( height = this.naturalHeight) ) {\r\n                                    height = maxImageHeight;\r\n                                    width = maxImageWidth;\r\n                                } else width = this.naturalWidth;\r\n                            } else width = this.clientWidth;\r\n                        } else width = $(this).width();\r\n                        \r\n                        if ( height > maxImageHeight )\r\n                        {\r\n                            var ko = maxImageHeight / maxImageWidth;\r\n                            width = parseInt( width * ko );\r\n                            height = parseInt( height * ko );\r\n                            $(editor.document['$']).find('div[photoid=' + photo_data.id + ']').css('width', width );\r\n                            \r\n                        }\r\n                            \r\n                        var div_pic = $(editor.document['$']).find('div[photoid=' + photo_data.id + '] div.img');\r\n                        div_pic.css('background-image', 'url(' + photo_data.src + ')');\r\n                        div_pic.css('background-size', width + 'px ' + height + 'px')\r\n                    };\r\n\r\n                    //загружаем фото, и по окончанию загрузки обрабыбатываем\r\n                    $(new Image()).load(handler).attr('src', photo_data.src);\r\n                    var e_data = { id : photo_data.id, src : '/i/ajaxLoading.gif', title: photo_data.title };\r\n                    editor.insertHtml( getPhotoEditHtml( e_data ), 'unfiltered_html' );\r\n                    editor.fire(\"clearEmptyP\");\r\n                    preparePhotos();\r\n                    $('#insertphoto_dialog').dialog('close');\r\n\r\n                    //заменяем размеры и получаем нужный размер фото\r\n//                    photo.src = photo.src.replace('60x60', '534x363');\r\n\r\n                }\r\n            });\r\n            \r\n            // editor.addCommand( 'insertphoto_edithtml', {\r\n            //     exec: function(editor, photo_data) {\r\n            //         getPhotoEditHtml(photo_data);\r\n                \r\n            // }}); ?\r\n            \r\n            /**\r\n             **************** События редактора\r\n             */\r\n            \r\n            /**\r\n             * событие происходит при загрузка едитора, после добавлених хтмл-кода в элемент\r\n             * нам теперь нужно, заменить внутренний вид на тот, что используется в эдиторе\r\n             * и навесить события\r\n             */\r\n            editor.on('instanceReady', dataReadyHandler);\r\n            \r\n            /**\r\n             * перед тем как отдать данные для сохранения, нам нужно\r\n             * подменить вёрстку всех блоков на внутреннюю\r\n             */\r\n            editor.on('beforeGetData', function(e){\r\n\r\n                if (isDefined(e.editor.document)) {\r\n\r\n                    //находим все блоки фото, сейчас они в редактируемом виде\r\n                    var jqPhotoBlocks = $(e.editor.document['$']).find('div.picture');\r\n\r\n                    //для каждого\r\n                    jqPhotoBlocks.each(function(i, e) {\r\n                        var jqElement = $(e);\r\n\r\n                        //выдираем нужные нам параметры из вёрстки\r\n                        //var photoId = parseInt(jqElement.attr('photoid'));\r\n                        var photoId = jqElement.attr('photoid');\r\n                        var src = jqElement.find('div.img').css('background-image').\r\n                                replace('url(', '').replace(')', '').replace(/\"/g, ''). //убираем обёртку бэкгроунда\r\n                                replace(window.location.protocol+'//'+window.location.hostname, ''); //убираем путь хоста\r\n                                // , т.к. можно сохранить на локальном, а если смотреть с теста, будет ничего не видно\r\n                        var title = (jqElement.find('div.t p').text() || '').substr(0, 300); //обрезаем длину\r\n\r\n                        //подставляем заменяющий блок перед заменяемый, который после грохаем\r\n                        var internal_html = getPhotoInternalHtml({'id':photoId, 'src':src, 'title':title})\r\n                        jqElement.before(internal_html);\r\n                        jqElement.remove();\r\n                    });\r\n                }\r\n            });\r\n\r\n            editor.on('plUpdateControls', preparePhotos); \r\n\r\n            /**\r\n             * возвращаем события при Ctrl-Z\r\n             */\r\n            editor.on('key', function(e){\r\n                if (isDefined(e.editor.document) && CKEDITOR.CTRL + 90 == e.data.keyCode) {//Ctrl-Z\r\n                    setTimeout(function(){\r\n                        preparePhotos();\r\n                    }, 100);\r\n                }\r\n            });\r\n\r\n        \teditor.ui.addButton('Photo', {\r\n\t\t\t\ticon    : '/i/ico_btn_img.gif',\r\n\t\t\t\tlabel   : 'Вставить фото',\r\n\t\t\t\tcommand : 'insertphoto_showdialog'\r\n\t\t\t});"],[0,"\r\n\t\t"]],"start1":113,"start2":113,"length1":1310,"length2":13781}]],"length":13915,"saved":false}
{"ts":1377422588737,"patch":[[{"diffs":[[0,"    "],[-1," window.insertphoto_dialog ="],[0," $('"]],"start1":7086,"start2":7086,"length1":36,"length2":8}]],"length":13887,"saved":false}
{"ts":1377422608353,"patch":[[{"diffs":[[0,"   ."],[-1,"dialog({\r\n                                       autoOpen: false,\r\n                                       modal: true,\r\n                                       height: 400,\r\n                                       width: 800,\r\n                                       title: \"Insert photo 2\"\r\n                                   });\r\n                    window.insertphoto_dialog.dialog('open');"],[1,"overlay();\r\n                    "],[0,"\r\n  "]],"start1":7294,"start2":7294,"length1":398,"length2":40}]],"length":13529,"saved":false}
{"ts":1377422748570,"patch":[[{"diffs":[[0,"         $('"],[-1,"<div id=\""],[1,"#"],[0,"insertphoto_"]],"start1":7082,"start2":7082,"length1":33,"length2":25},{"diffs":[[0,"photo_dialog"],[-1,"\"></div>"],[0,"')\r\n        "]],"start1":7101,"start2":7101,"length1":32,"length2":24},{"diffs":[[0,"                "],[1,"add_photo"],[0,"\r\n              "]],"start1":7298,"start2":7298,"length1":32,"length2":41}]],"length":13522,"saved":false}
{"ts":1377422759851,"patch":[[{"diffs":[[0,"        "],[-1,"add_photo"],[0,"\r\n      "]],"start1":7306,"start2":7306,"length1":25,"length2":16}]],"length":13513,"saved":false}
{"ts":1377422877457,"patch":[[{"diffs":[[0,"              \r\n"],[1,"    // this.callback = callback;\r\n    // $('#add_tezis').centering().overlay().show();\r\n    // $('#overlay').click(function(){\r\n    //     $('#add_tezis .close:not(.choose)').trigger('click');\r\n    // });\r\n"],[0,"                "]],"start1":7322,"start2":7322,"length1":32,"length2":238}]],"length":13719,"saved":false}
{"ts":1377422917211,"patch":[[{"diffs":[[0,"o_dialog')\r\n"],[1,"                                    .centering()\r\n "],[0,"            "]],"start1":7105,"start2":7105,"length1":24,"length2":75},{"diffs":[[0,"0\"></iframe>')\r\n"],[1," "],[0,"                "]],"start1":7281,"start2":7281,"length1":32,"length2":33}]],"length":13771,"saved":false}
{"ts":1377422926367,"patch":[[{"diffs":[[0,"verlay()"],[1,"\r\n                                    .show()"],[0,";\r\n     "]],"start1":7335,"start2":7335,"length1":16,"length2":61}]],"length":13816,"saved":false}
{"ts":1377423155788,"patch":[[{"diffs":[[0,"itor_name;\r\n"],[1,"                    \r\n                    $('#insertphoto_dialog .content') .html('<iframe style=\"border: 0px; \" src=\"' + page + '\" width=\"700\" height=\"580\"></iframe>')\r\n"],[0,"            "]],"start1":7059,"start2":7059,"length1":24,"length2":194},{"diffs":[[0,"    "],[-1,".html('<iframe style=\"border: 0px; \" src=\"' + page + '\" width=\"700\" height=\"580\"></iframe>')"],[0,"\r\n  "]],"start1":7369,"start2":7369,"length1":100,"length2":8}]],"length":13894,"saved":false}
{"ts":1377423399210,"patch":[[{"diffs":[[0,".content"],[1," .iframe_place"],[0,"') .html"]],"start1":7136,"start2":7136,"length1":16,"length2":30}]],"length":13908,"saved":false}
{"ts":1377423483211,"patch":[[{"diffs":[[0,"ialog')."],[-1,"dialog('close');"],[0,"\r\n\r\n    "]],"start1":10685,"start2":10685,"length1":32,"length2":16}]],"length":13892,"saved":false}
{"ts":1377423521226,"patch":[[{"diffs":[[0,"    "],[-1,"$('#insertphoto_dialog')."],[1,"\r\n    this.callback = callback;\r\n    $('#insertphoto_dialog').centering().overlay().show();\r\n    $('#overlay').click(function(){\r\n        $('#add_tezis .close:not(.choose)').trigger('click');\r\n    });"],[0,"\r\n\r\n"]],"start1":10664,"start2":10664,"length1":33,"length2":208}]],"length":14067,"saved":false}
{"ts":1377423525439,"patch":[[{"diffs":[[0,"        $('#"],[-1,"add_tezis"],[1,"insertphoto_dialog"],[0," .close:not("]],"start1":10798,"start2":10798,"length1":33,"length2":42}]],"length":14076,"saved":false}
{"ts":1377423531291,"patch":[[{"diffs":[[0,"  \r\n"],[-1,"    this.callback = callback;\r\n    $('#insertphoto_dialog').centering().overlay().show();\r\n    $('#overlay').click(function(){\r\n        $('#insertphoto_dialog .close:not(.choose)').trigger('click');\r\n    });\r\n\r\n"],[0,"    "]],"start1":10666,"start2":10666,"length1":219,"length2":8}]],"length":13865,"saved":false}
{"ts":1377423560452,"patch":[[{"diffs":[[0,"              \r\n"],[1,"                    this.callback = callback;\r\n                    $('#insertphoto_dialog').centering().overlay().show();\r\n                    $('#overlay').click(function(){\r\n                        $('#insertphoto_dialog .close:not(.choose)').trigger('click');\r\n                    });\r\n"],[0,"                "]],"start1":7077,"start2":7077,"length1":32,"length2":321},{"diffs":[[0,"0\"></iframe>')\r\n"],[-1,""],[0,"                "]],"start1":7528,"start2":7528,"length1":32,"length2":32},{"diffs":[[0,"()\r\n"],[-1,"                                    \r\n"],[0,"    "]],"start1":7636,"start2":7636,"length1":46,"length2":8},{"diffs":[[0,".overlay()\r\n"],[-1,""],[0,"            "]],"start1":7676,"start2":7676,"length1":24,"length2":24},{"diffs":[[0,"      .show();\r\n"],[1,"                                    \r\n"],[0,"                "]],"start1":7718,"start2":7718,"length1":32,"length2":70}]],"length":14154,"saved":false}
{"ts":1377423573923,"patch":[[{"diffs":[[0,"           });\r\n"],[1,"                    \r\n"],[0,"                "]],"start1":7366,"start2":7366,"length1":32,"length2":54},{"diffs":[[0,"og')"],[-1,"\r\n                                    .centering()\r\n                                    .overlay()\r\n                                    "],[1,".centering().overlay()"],[0,".sho"]],"start1":7606,"start2":7606,"length1":144,"length2":30}]],"length":14062,"saved":false}
{"ts":1377423721416,"patch":[[{"diffs":[[0,"  \r\n"],[-1,"                    this.callback = callback;\r\n                    $('#insertphoto_dialog').centering().overlay().show();\r\n                    $('#overlay').click(function(){\r\n                        $('#insertphoto_dialog .close:not(.choose)').trigger('click');\r\n                    });"],[0,"\r\n"],[1,""],[0,"    "]],"start1":7089,"start2":7089,"length1":297,"length2":10},{"diffs":[[0,"              \r\n"],[-1,""],[0,"                "]],"start1":7377,"start2":7377,"length1":32,"length2":32},{"diffs":[[0,"                "],[1,"    // инициализация полей диалога значениями по умолчанию\r\n                    $('#' + editor.name).trigger('showTezis', [function(message){\r\n                            \r\n                        if ($.trim(message).length) {\r\n                            \r\n                            // посылаем команду для добавления контента\r\n                            editor.execCommand('pl_cmd_tezis', [message]);\r\n                        }\r\n                    }, '']);"],[0,"\r\n              "]],"start1":7397,"start2":7397,"length1":32,"length2":494}]],"length":14237,"saved":false}
{"ts":1377423733238,"patch":[[{"diffs":[[0,"show"],[-1,"Tezis"],[1,"InsertPhoto"],[0,"', ["]],"start1":7523,"start2":7523,"length1":13,"length2":19}]],"length":14243,"saved":false}
{"ts":1377423755375,"patch":[[{"diffs":[[0,"  \r\n"],[-1,"                        if ($.trim(message).length) {\r\n                            \r\n"],[0,"    "]],"start1":7588,"start2":7588,"length1":93,"length2":8},{"diffs":[[0,"            "],[1,"//"],[0,"editor.execC"]],"start1":7681,"start2":7681,"length1":24,"length2":26}]],"length":14160,"saved":false}
{"ts":1377423757874,"patch":[[{"diffs":[[0,"){\r\n"],[-1,"                            \r\n"],[0,"    "]],"start1":7558,"start2":7558,"length1":38,"length2":8}]],"length":14130,"saved":false}
{"ts":1377423772155,"patch":[[{"diffs":[[0,"                "],[-1,"   }"],[0,"\r\n              "]],"start1":7718,"start2":7718,"length1":36,"length2":32}]],"length":14126,"saved":false}
{"ts":1377423828938,"patch":[[{"diffs":[[0,"              \r\n"],[1,"                    $('#insertphoto_dialog .close:not(.choose)').trigger('click');\r\n                    \r\n"],[0,"                "]],"start1":10915,"start2":10915,"length1":32,"length2":138}]],"length":14232,"saved":false}
{"ts":1377439711412,"patch":[[{"diffs":[[0,"hotos); \r\n\r\n"],[1,"            editor.on('getData', dataReadyHandler);\r\n"],[0,"            "]],"start1":13661,"start2":13661,"length1":24,"length2":77}]],"length":14285,"saved":false}
{"ts":1377439736227,"patch":[[{"diffs":[[0,"hotos); \r\n\r\n"],[1,"            /**\r\n             * событие происходит после того, как отдали данные на сохранение, теперь нужно провести обратную замену на редактируемый вид\r\n             * и снова навесить события. Иначе в редакторе останется служебная верстка.\r\n             */\r\n"],[0,"            "]],"start1":13661,"start2":13661,"length1":24,"length2":286}]],"length":14547,"saved":false}
{"ts":1377439947607,"patch":[[{"diffs":[[0,");\r\n"],[-1,"                    \r\n    // this.callback = callback;\r\n    // $('#add_tezis').centering().overlay().show();\r\n    // $('#overlay').click(function(){\r\n    //     $('#add_tezis .close:not(.choose)').trigger('click');\r\n    // });\r\n                    // window.insertphoto_dialog = $('<div id=\"insertphoto_dialog\"></div>')\r\n                    //                .html('<iframe style=\"border: 0px; \" src=\"' + page + '\" width=\"700\" height=\"580\"></iframe>')\r\n                    //                .dialog({\r\n                    //                    autoOpen: false,\r\n                    //                    modal: true,\r\n                    //                    height: 400,\r\n                    //                    width: 800,\r\n                    //                    title: \"Insert photo 2\"\r\n                    //                });\r\n                    // window.insertphoto_dialog.dialog('open');\r\n"],[0,"    "]],"start1":7762,"start2":7762,"length1":913,"length2":8}]],"length":13642,"saved":false}
{"ts":1377439953196,"patch":[[{"diffs":[[0,"   \r"],[-1,"\n\r\n                    \r"],[0,"\n   "]],"start1":7088,"start2":7088,"length1":32,"length2":8}]],"length":13618,"saved":false}
{"ts":1377440083148,"patch":[[{"diffs":[[0,"photoid=' + "],[-1,"photo_data"],[1,"this"],[0,".id + ']').c"]],"start1":9076,"start2":9076,"length1":34,"length2":28}]],"length":13612,"saved":false}
{"ts":1377440088957,"patch":[[{"diffs":[[0," + this."],[1,"attr("],[0,"id"],[1,")"],[0," + ']')."]],"start1":9085,"start2":9085,"length1":18,"length2":24}]],"length":13618,"saved":false}
{"ts":1377440093177,"patch":[[{"diffs":[[0,"is.attr("],[1,"'"],[0,"id"],[1,"'"],[0,") + ']')"]],"start1":9090,"start2":9090,"length1":18,"length2":20}]],"length":13620,"saved":false}
{"ts":1377440133330,"patch":[[{"diffs":[[0,"oid=' + "],[1,"$("],[0,"this"],[1,")"],[0,".attr('i"]],"start1":9080,"start2":9080,"length1":20,"length2":23}]],"length":13623,"saved":false}
{"ts":1377440157907,"patch":[[{"diffs":[[0," {\r\n"],[-1,"                        var width, height;\r\n                        //Пытаемся определить размер\r\n                        if ( ! ( height = $(this).height() ) ) {\r\n                            if ( ! ( height = this.clientHeight) ) {\r\n                                if ( ! ( height = this.naturalHeight) ) {\r\n                                    height = maxImageHeight;\r\n                                    width = maxImageWidth;\r\n                                } else width = this.naturalWidth;\r\n                            } else width = this.clientWidth;\r\n                        } else width = $(this).width();\r\n                        \r\n                        if ( height > maxImageHeight )\r\n                        {\r\n                            var ko = maxImageHeight / maxImageWidth;\r\n                            width = parseInt( width * ko );\r\n                            height = parseInt( height * ko );\r\n                            $(editor.document['$']).find('div[photoid=' + $(this).attr('id') + ']').css('width', width );\r\n                            \r\n                        }"],[0,"\r\n  "]],"start1":8090,"start2":8090,"length1":1106,"length2":8}]],"length":12525,"saved":false}
{"ts":1377440257127,"patch":[[{"diffs":[[0,"           /**\r\n"],[1,"             * если фото вертикальное - масштабирует его размеры под максимально разрешенную высоту \r\n             */\r\n            var normalizePhotoBlock = function(img) {\r\n                                        var width, height;\r\n                        //Пытаемся определить размер\r\n                        if ( ! ( height = $(this).height() ) ) {\r\n                            if ( ! ( height = this.clientHeight) ) {\r\n                                if ( ! ( height = this.naturalHeight) ) {\r\n                                    height = maxImageHeight;\r\n                                    width = maxImageWidth;\r\n                                } else width = this.naturalWidth;\r\n                            } else width = this.clientWidth;\r\n                        } else width = $(this).width();\r\n                        \r\n                        if ( height > maxImageHeight )\r\n                        {\r\n                            var ko = maxImageHeight / maxImageWidth;\r\n                            width = parseInt( width * ko );\r\n                            height = parseInt( height * ko );\r\n                            $(editor.document['$']).find('div[photoid=' + $(this).attr('id') + ']').css('width', width );\r\n                            \r\n                        }\r\n            }\r\n            \r\n            /**\r\n"],[0,"             * п"]],"start1":3497,"start2":3497,"length1":32,"length2":1368}]],"length":13861,"saved":false}
{"ts":1377440267377,"patch":[[{"diffs":[[0,"ю высоту"],[-1," "],[1,"\r\n             * @param img"],[0,"\r\n      "]],"start1":3604,"start2":3604,"length1":17,"length2":43}]],"length":13887,"saved":false}
{"ts":1377440295127,"patch":[[{"diffs":[[0,"= function() {\r\n"],[-1,"\r\n"],[1,"                        normalizePhotoBlock(this);"],[0,"                "]],"start1":9440,"start2":9440,"length1":34,"length2":82}]],"length":13935,"saved":false}
{"ts":1377440372929,"patch":[[{"diffs":[[0,"        "],[-1,"        //"],[0,"editor.e"]],"start1":8985,"start2":8985,"length1":26,"length2":16}]],"length":13925,"saved":false}
{"ts":1377440379402,"patch":[[{"diffs":[[0,"            "],[1,"        "],[0,"editor.execC"]],"start1":8981,"start2":8981,"length1":24,"length2":32}]],"length":13933,"saved":false}
{"ts":1377440396928,"patch":[[{"diffs":[[0,"age]);\r\n"],[-1,"                     \r\n"],[0,"        "]],"start1":9041,"start2":9041,"length1":39,"length2":16}]],"length":13910,"saved":false}
{"ts":1377440639962,"patch":[[{"diffs":[[0,"  \r\n"],[-1,"                        var div_pic = $(editor.document['$']).find('div[photoid=' + photo_data.id + '] div.img');\r\n                        div_pic.css('background-image', 'url(' + photo_data.src + ')');\r\n                        div_pic.css('background-size', width + 'px ' + height + 'px')\r\n"],[0,"    "]],"start1":9507,"start2":9507,"length1":299,"length2":8}]],"length":13619,"saved":false}
{"ts":1377440652106,"patch":[[{"diffs":[[0,"              \r\n"],[1,"                            var div_pic = $(editor.document['$']).find('div[photoid=' + photo_data.id + '] div.img');\r\n                            div_pic.css('background-image', 'url(' + photo_data.src + ')');\r\n                            div_pic.css('background-size', width + 'px ' + height + 'px')\r\n"],[0,"                "]],"start1":4786,"start2":4786,"length1":32,"length2":335}]],"length":13922,"saved":false}
{"ts":1377440691171,"patch":[[{"diffs":[[0,"d=' + $("],[-1,"this"],[1,"img"],[0,").attr('"]],"start1":4717,"start2":4717,"length1":20,"length2":19},{"diffs":[[0,"photoid=' + "],[-1,"photo_data.id"],[1,"$(img).attr('id')"],[0," + '] div.im"]],"start1":4877,"start2":4877,"length1":37,"length2":41},{"diffs":[[0,"', 'url(' + "],[-1,"photo_data."],[1,"$(img).attr('"],[0,"src"],[1,"')"],[0," + ')');\r\n  "]],"start1":4981,"start2":4981,"length1":38,"length2":42}]],"length":13929,"saved":false}
{"ts":1377440798506,"patch":[[{"diffs":[[0,"             };\r"],[1,"\n                        \r\n                        //загружаем фото, и по окончанию загрузки обрабыбатываем\r\n                        $(new Image()).load(handler).attr('src', photo_data.src);\r\n                        var e_data = { id : photo_data.id, src : '/i/ajaxLoading.gif', title: photo_data.title };\r\n                        editor.insertHtml( getPhotoEditHtml( e_data ), 'unfiltered_html' );\r"],[0,"\n\r\n             "]],"start1":3205,"start2":3205,"length1":32,"length2":431}]],"length":14328,"saved":false}
{"ts":1377440830313,"patch":[[{"diffs":[[0,"              \r\n"],[1,"                        //обработчик загрузки фото\r\n                        var handler = function() {\r\n                            normalizePhotoBlock(this);                            \r\n                        };\r\n"],[0,"                "]],"start1":3232,"start2":3232,"length1":32,"length2":248}]],"length":14544,"saved":false}
{"ts":1377440859050,"patch":[[{"diffs":[[0," };\r"],[-1,"\n                        editor.insertHtml( getPhotoEditHtml( e_data ), 'unfiltered_html' );\r"],[0,"\n\r\n "]],"start1":3739,"start2":3739,"length1":101,"length2":8},{"diffs":[[0,"otoEditHtml("],[-1,"photo"],[1,"e"],[0,"_data));\r\n  "]],"start1":3840,"start2":3840,"length1":29,"length2":25}]],"length":14447,"saved":false}
{"ts":1377441089721,"patch":[[{"diffs":[[0,"                "],[-1,"$("],[1,"var img = "],[0,"new Image()).loa"]],"start1":10447,"start2":10447,"length1":34,"length2":42},{"diffs":[[0," new Image()"],[-1,").load(handler"],[1,".attr('id', photo_data.id"],[0,").attr('src'"]],"start1":10472,"start2":10472,"length1":38,"length2":49},{"diffs":[[0," photo_data.src)"],[-1,";"],[1,".attr('title', photo_data.title);\r\n                    $().load(handler)"],[0,"\r\n              "]],"start1":10522,"start2":10522,"length1":33,"length2":104}]],"length":14537,"saved":false}
{"ts":1377441099253,"patch":[[{"diffs":[[0,"      $("],[1,"img"],[0,").load(h"]],"start1":10587,"start2":10587,"length1":16,"length2":19},{"diffs":[[0,"handler)"],[1,";"],[0,"\r\n      "]],"start1":10605,"start2":10605,"length1":16,"length2":17}]],"length":14541,"saved":false}
{"ts":1377441111380,"patch":[[{"diffs":[[0,"        "],[-1,"$("],[1,"var img = "],[0,"new Imag"]],"start1":3562,"start2":3562,"length1":18,"length2":26},{"diffs":[[0," Image()"],[-1,").load(handler"],[1,".attr('id', photo_data.id"],[0,").attr('"]],"start1":3583,"start2":3583,"length1":30,"length2":41},{"diffs":[[0,"ata.src)"],[1,".attr('title', photo_data.title);\r\n                        $(img).load(handler)"],[0,";\r\n     "]],"start1":3637,"start2":3637,"length1":16,"length2":95}]],"length":14639,"saved":false}
{"ts":1377441139084,"patch":[[{"diffs":[[0,"      var img = "],[1,"$("],[0,"new Image().attr"]],"start1":3564,"start2":3564,"length1":32,"length2":34},{"diffs":[[0," = $(new Image()"],[1,")"],[0,".attr('id', phot"]],"start1":3577,"start2":3577,"length1":32,"length2":33}]],"length":14642,"saved":false}
{"ts":1377441149557,"patch":[[{"diffs":[[0,"r img = "],[1,"$("],[0,"new Imag"]],"start1":10566,"start2":10566,"length1":16,"length2":18},{"diffs":[[0," Image()"],[1,")"],[0,".attr('i"]],"start1":10579,"start2":10579,"length1":16,"length2":17}]],"length":14645,"saved":false}
{"ts":1377441264301,"patch":[[{"diffs":[[0,"ю загрузки обраб"],[-1,"ыб"],[0,"атываем\r\n       "]],"start1":10517,"start2":10517,"length1":34,"length2":32}]],"length":14643,"saved":false}
{"ts":1377441427042,"patch":[[{"diffs":[[0,"ght = $("],[-1,"this"],[1,"img"],[0,").height"]],"start1":4482,"start2":4482,"length1":20,"length2":19},{"diffs":[[0,"eight = "],[-1,"this"],[1,"img"],[0,".clientH"]],"start1":4549,"start2":4549,"length1":20,"length2":19},{"diffs":[[0,"eight = "],[-1,"this"],[1,"img"],[0,".natural"]],"start1":4622,"start2":4622,"length1":20,"length2":19},{"diffs":[[0,"width = "],[-1,"this"],[1,"img"],[0,".natural"]],"start1":4815,"start2":4815,"length1":20,"length2":19},{"diffs":[[0,"width = "],[-1,"this"],[1,"img"],[0,".clientW"]],"start1":4877,"start2":4877,"length1":20,"length2":19},{"diffs":[[0,"dth = $("],[-1,"this"],[1,"img"],[0,").width("]],"start1":4936,"start2":4936,"length1":20,"length2":19}]],"length":14637,"saved":false}
{"ts":1377441440824,"patch":[[{"diffs":[[0,"        "],[-1,"                "],[0,"var widt"]],"start1":4348,"start2":4348,"length1":32,"length2":16}]],"length":14621,"saved":false}
{"ts":1377441611913,"patch":[[{"diffs":[[0,"              \r\n"],[1,"                        var div_pic = $(editor.document['$']).find('div[photoid=' + $(img).attr('id') + '] div.img');\r\n"],[0,"                "]],"start1":4953,"start2":4953,"length1":32,"length2":151},{"diffs":[[0,"    "],[-1,"var "],[0,"div_pic"],[-1," = $(editor.document['$']).find('div[photoid=' + $(img).attr('id') + '] div.img"],[1,".css('background-size', width + 'px ' + height + 'px"],[0,"')"],[-1,";"],[0,"\r\n    "],[1,"                    }\r\n"],[0,"    "]],"start1":5541,"start2":5541,"length1":107,"length2":98},{"diffs":[[0,");\r\n"],[-1,"                            div_pic.css('background-size', width + 'px ' + height + 'px')\r\n                        }"],[0,"\r\n  "]],"start1":5724,"start2":5724,"length1":124,"length2":8}]],"length":14615,"saved":false}
{"ts":1377441823465,"patch":[[{"diffs":[[0,"is);"],[-1,"                            "],[0,"\r\n  "]],"start1":10378,"start2":10378,"length1":36,"length2":8}]],"length":14587,"saved":false}
